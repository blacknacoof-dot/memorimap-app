-- Fix misclassified natural burial facilities
-- 파일: 20260120_fix_natural_burial_misclassification.sql

-- ============================================
-- 분석 결과
-- ============================================
-- 교회 자연장지/수목장 (정상): 교회가 운영하는 자연장지는 올바른 분류
-- 예: 서울신흥교회 하늘계단수목장, 진주대광교회 자연장지 등
--
-- 삭제 대상: 교회/수도원 건물 자체 (자연장 아님)
-- 재분류 대상: 용천바다 (해양장)

-- ============================================
-- 1. 재분류: 용천바다 (자연장 → 해양장)
-- ============================================

UPDATE facilities 
SET category = 'sea_burial'
WHERE id = '38c3174d-ac2d-45e1-86c2-540f7ec9a11e'  -- 용천바다
  AND category = 'natural_burial';

-- ============================================
-- 2. 삭제: 교회/수도원 건물 (자연장 시설 아님)
-- ============================================

DELETE FROM facilities
WHERE id IN (
    '8562c9e4-4b3d-4d02-a0ab-7f8bbdcb25fb',  -- 화성나래원 분양사무실
    'eb8b0d18-6180-40aa-98fc-e8ca439c8249',  -- 전곡감리교회 (교회 본체)
    '59078c21-61cf-4649-a0c0-488b297f7fd0',  -- 올리베따노성베네딕도수도원
    'fc9cdfbb-c782-4c8d-b764-593ba404f107',  -- 천주교인보성체수도회
    'c4281916-1899-4a3f-b677-9e6de1748756',  -- 용인로뎀파크 교회 (교회 본체)
    'f65c5e77-ecbf-4817-b30f-1685894ddcc4',  -- 선한목자교회 (교회 본체)
    '7b08fe02-f18b-4369-8028-6c8d572abfe7'   -- 함평교회 (교회 본체)
);

-- ============================================
-- 3. 유지: 교회 운영 자연장지 (정상 분류)
-- ============================================
-- 아래 시설들은 교회가 운영하는 자연장지로 올바른 분류입니다:
-- - 서울신흥교회 하늘계단수목장
-- - 진주대광교회 자연장지
-- - 평안교회 자연장지
-- - 원주제일교회자연장지
-- - 살렘전원그리스도의교회자연장지
-- - 안성제일교회 수목장
-- - 기독교대한성결교회자연장지
-- - 진주제일교회 수목장
-- - 함평중앙교회 부활동산

-- ============================================
-- 4. 확인 필요
-- ============================================
-- 어승생한울누리공원: 실제 자연장 시설 여부 확인 필요
-- (현재 유지, 추후 필요 시 재분류)

-- ============================================
-- 5. 실행 결과 확인
-- ============================================

SELECT 
    category,
    COUNT(*) as count
FROM facilities
WHERE category IN ('natural_burial', 'sea_burial')
GROUP BY category
ORDER BY category;

DO $$
BEGIN
    RAISE NOTICE '========================================';
    RAISE NOTICE 'Natural burial facility cleanup complete';
    RAISE NOTICE '- Reclassified: 1 (용천바다 → sea_burial)';
    RAISE NOTICE '- Deleted: 7 (churches/monasteries)';
    RAISE NOTICE '- Retained: Church-operated natural burial sites';
    RAISE NOTICE '========================================';
END $$;
